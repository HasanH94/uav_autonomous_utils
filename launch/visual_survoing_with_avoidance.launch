<launch>
    <!-- HYBRID YAW PID CONTROLLER (MASTER) -->
    <!-- This node calculates the desired yaw rate and combines it with the linear velocity from the VFH3D node. -->
    <node pkg="uav_autonomous_utils" type="control/hybrid_yaw_rate_pid.py" name="hybrid_yaw_controller" output="screen">
        <!-- PID gains for Yaw -->
        <param name="kp_yaw" value="0.8" />
        <param name="ki_yaw" value="0.0" />
        <param name="kd_yaw" value="0.1" />
        <!-- Controller parameters -->
        <param name="max_speed" value="2.0" />
        <param name="max_yaw_rate" value="2.0" />
        <param name="yaw_switch_distance" value="1.5" />
        <param name="position_tolerance" value="0.3" />
        <param name="yaw_tolerance" value="0.1" />
        <param name="is_gps_navigation_mode" value="false" />
        <!-- Remapping inputs -->
        <remap from="/move_base_simple/goal" to="/move_base_visual"/>
        <remap from="/uav/odometry" to="/mavros/local_position/odom"/>
        <!-- The controller now gets its linear velocity command from the vfh3d node -->
        <remap from="/apf_vel" to="/vfh3d/cmd_pose"/>
        <!-- Final output to the drone -->
        <remap from="/mavros/setpoint_velocity/cmd_vel" to="/mavros/setpoint_velocity/cmd_vel"/>
    </node>

    <!-- VFH3D LOCAL PLANNER (LINEAR VELOCITY CALCULATOR) -->
    <!-- This node calculates the obstacle-free linear velocity and publishes it for the master controller. -->
    <node name="vfh3d_node" pkg="vfh3d" type="vfh3d_node" output="screen">
        <param name="octomap_topic" value="/octomap_binary"/>
        <param name="hist_resolution" value="0.087222222" />
        <param name="map_resolution" value="0.5" />
        <param name="max_plan_range" value="5.0" />
        <param name="const_a" value="1.0" />
        <param name="pose_topic" value="/mavros/local_position/pose" />
        <param name="cmd_pose_topic" value="/move_base_visual" />
        <param name="vehicle_safety_radius" value="0.5" />
        <param name="turning_radius_l" value="0.2" />
        <param name="turning_radius_r" value="0.2" />
        <remap from="/vfh3d/cmd_pose" to="/vfh3d/cmd_pose"/>
        <param name="vehicle_size_x" value="0.5" />
        <param name="vehicle_size_y" value="0.5" />
        <param name="vehicle_size_z" value="0.5" />
    </node>

</launch>